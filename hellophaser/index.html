<!DOCTYPE html>
<head>
  <meta charset="UTF-8" />
  <title>hello phaser!</title>
  <script src="phaser.min.js"></script>
</head>
<body>

  <script type="text/javascript">

  window.onload = function() {
    var game = new Phaser.Game(800, 800, Phaser.AUTO, '', { preload: preload, create: create, render: render, update: update});

    function preload () {
    
      game.load.image('square', 'grid.jpeg');
      game.load.image('bqueen', '/images/blackqueen.png');
      game.load.image('bking', '/images/blackking.png');
      game.load.image('b1Rook', '/images/blackrook.png');
      game.load.image('b2Rook', '/images/blackrook.png');
      game.load.image('b1Bishop', '/images/blackbishop.png');
      game.load.image('b2Bishop', '/images/blackbishop.png');
      game.load.image('b1Knight', '/images/blackknight.png');
      game.load.image('b2Knight', '/images/blackknight.png');
  }

    var grid = [];
    var currentTile = new Phaser.Point();
    var bQueen;
    var bKing;
    var b1Rook;
    var b2Rook;
    var b1Bishop;
    var b2Bishop;
    var b1Knight;
    var b2Knight;
    
    function create () {
      game.physics.startSystem(Phaser.Physics.ARCADE);

        for (var y=0; y<8; y++) 
        {
          grid[y]= [];
          for (var x=0; x<8; x++){
            grid[y][x] = game.add.sprite(x * 100, y * 100, 'square');
          }
        }


        game.input.onDown.add(clickedBlock, this);
        // queen is added as sprite
        bQueen = game.add.sprite(305, 5, 'bqueen');
        // resized to fit the grid 
        bQueen.height = 90;
        bQueen.width = 90;

        bQueen.inputEnabled = true;
        bQueen.input.enableDrag();
        //snaps to the center of the nearest grid after being dragged
        bQueen.input.enableSnap(100, 100, false, true, 5, 5);
        // when done dragging, calls a function that checks if this position is allowed
        // queen.events.onDragStop.add(currentPos, this);
        // sets the original 
        bQueen.originX = bQueen.x;
        bQueen.originY = bQueen.y;
       
        bKing = game.add.sprite(405, 5, 'bking');
        bKing.inputEnabled = true;
        bKing.input.enableDrag();
        bKing.input.enableSnap(100, 100, false, true, 5, 5);
        bKing.events.onDragStop.add(kingMove, this);
        bKing.originX = bKing.x;
        bKing.originY = bKing.y;
        bKing.height = 90;
        bKing.width = 90;

        b1Rook = game.add.sprite(705, 5, 'b1Rook');
        b1Rook.inputEnabled = true;
        b1Rook.input.enableDrag();
        b1Rook.input.enableSnap(100, 100, false, true, 15, 15);
        b1Rook.events.onDragStop.add(rookMove, this);
        b1Rook.originX = b1Rook.x;
        b1Rook.originY = b1Rook.y;
        b1Rook.height = 90;
        b1Rook.width = 90;

        b2Rook = game.add.sprite(5, 5, 'b2Rook');
        b2Rook.inputEnabled = true;
        b2Rook.input.enableDrag();
        b2Rook.input.enableSnap(100, 100, false, true, 5, 5);
        b2Rook.events.onDragStop.add(rookMove, this);
        b2Rook.originX = b2Rook.x;
        b2Rook.originY = b2Rook.y;
        b2Rook.height = 90;
        b2Rook.width = 90;

        b1Bishop = game.add.sprite(205, 5, 'b1Bishop');
        b1Bishop.inputEnabled = true;
        b1Bishop.input.enableDrag();
        b1Bishop.input.enableSnap(100, 100, false, true, 5, 5);
        b1Bishop.events.onDragStop.add(bishopMove, this);
        b1Bishop.originX = b1Bishop.x;
        b1Bishop.originY = b1Bishop.y;
        b1Bishop.height = 90;
        b1Bishop.width = 90;

        b2Bishop = game.add.sprite(505, 5, 'b2Bishop');
        b2Bishop.inputEnabled = true;
        b2Bishop.input.enableDrag();
        b2Bishop.input.enableSnap(100, 100, false, true, 5, 5);
        b2Bishop.events.onDragStop.add(bishopMove, this);
        b2Bishop.originX = b2Bishop.x;
        b2Bishop.originY = b2Bishop.y;
        b2Bishop.height = 90;
        b2Bishop.width = 90;

        b1Knight = game.add.sprite(105, 5, 'b1Knight');
        b1Knight.inputEnabled = true;
        b1Knight.input.enableDrag();
        b1Knight.input.enableSnap(100, 100, false, true, 5, 5);
        b1Knight.events.onDragStop.add(knightMove, this);
        b1Knight.originX = b1Knight.x;
        b1Knight.originY = b1Knight.y;
        b1Knight.height = 90;
        b1Knight.width = 90;

        b2Knight = game.add.sprite(605, 5, 'b2Knight');
        b2Knight.inputEnabled = true;
        b2Knight.input.enableDrag();
        b2Knight.input.enableSnap(100, 100, false, true, 5, 5);
        b2Knight.events.onDragStop.add(knightMove, this);
        b2Knight.originX = b2Knight.x;
        b2Knight.originY = b2Knight.y;
        b2Knight.height = 90;
        b2Knight.width = 90;

    }

    function clickedBlock() {
      if (currentTile.x >= 0 && currentTile.x <= 8 && currentTile.y >= 0 && currentTile.y <= 8)
      {
        square = grid[currentTile.y][currentTile.x];
        square.alpha = 0.5;
      }
      console.log("clicked!");
    }

    function kingMove(item, pointer){
      if (Math.abs(item.originX - item.x) > 100 || Math.abs(item.originY - item.y) > 100) {
        game.add.tween(item).to({x: item.originX, y: item.originY}, 400, Phaser.Easing.Back.Out, true);
      } else {
        item.originX = item.x;
        item.originY = item.y;
      }
    }
    function rookMove(item, pointer){
      if (item.originX != item.x && item.originY != item.y){
        game.add.tween(item).to({x: item.originX, y: item.originY}, 400, Phaser.Easing.Back.Out, true);
      }
        else {
          item.originX = item.x;
          item.originY = item.y;
        }
    }

    function bishopMove(item, pointer){
      if (item.originX === item.x || item.originY === item.y){
        game.add.tween(item).to({x: item.originX, y: item.originY}, 400, Phaser.Easing.Back.Out, true);
  
      }else{
        item.originX = item.x;
        item.originY = item.y;
      }
    }

    function knightMove(item, pointer){
      console.log(item.originX);
      console.log(item.originY);
      if(Math.abs(item.originX - item.x) === 200 && Math.abs(item.originY - item.y) === 100 || Math.abs(item.originX - item.x) === 100 && Math.abs(item.originY - item.y) === 100){
        item.originX = item.x;
        item.originY = item.y;
        console.log("true if statement.");
      }else{
        game.add.tween(item).to({x: item.originX, y: item.originY}, 400, Phaser.Easing.Back.Out, true);
        console.log("else statement");
      }
    }

    function update(){
      currentTile.x = this.game.math.snapToFloor(game.input.x, 100)/100;
      currentTile.y = this.game.math.snapToFloor(game.input.y, 100)/100;
    }

    function render() {
      game.debug.text('Tile X: ' + currentTile.x + 'Y: ' + currentTile.y, 5, 5);
    }
};

</script>

</body>
</html>