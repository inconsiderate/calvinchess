<!DOCTYPE html>
<head>
  <meta charset="UTF-8" />
  <title>hello phaser!</title>
  <script src="phaser.min.js"></script>



  <script src="knights.js"></script>
  <script src='rooks.js'></script>
</head>
<body>

  <script type="text/javascript">

  window.onload = function() {
    window.game = new Phaser.Game(800, 800, Phaser.AUTO, '', { preload: preload, create: create, render: render, update: update});

    function preload () {
    
      game.load.image('square', 'grid.jpeg');
      game.load.image('bqueen', '/images/blackqueen.png');
      game.load.image('bking', '/images/blackking.png');
      game.load.image('bRook', '/images/blackrook.png');
      game.load.image('b1Bishop', '/images/blackbishop.png');
      game.load.image('b2Bishop', '/images/blackbishop.png');
      game.load.image('bknight', '/images/blackknight.png');
  }

    var grid = [];
    var currentTile = new Phaser.Point();
    var bQueen;
    var bKing;
    var b1Rook;
    var b2Rook;
    var b1Bishop;
    var b2Bishop;
    var b1Knight;
    var b2Knight;
    
    function create () {
      game.physics.startSystem(Phaser.Physics.ARCADE);

        for (var y=0; y<8; y++) 
        {
          grid[y]= [];
          for (var x=0; x<8; x++){
            grid[y][x] = game.add.image(x * 100, y * 100, 'square');
          }
        }

        var allPieces = game.add.group();

        game.input.onDown.add(clickedBlock, this);
        // queen is added as sprite
        bQueen = game.add.sprite(305, 5, 'bqueen');

        bQueen.inputEnabled = true;
        bQueen.input.enableDrag();
        //snaps to the center of the nearest grid after being dragged
        bQueen.input.enableSnap(100, 100, false, true, 5, 5);
        // when done dragging, calls a function that checks if this position is allowed
        // queen.events.onDragStop.add(currentPos, this);
        // sets the original 
        bQueen.originX = bQueen.x;
        bQueen.originY = bQueen.y;

        allPieces.add(bQueen);
       
        bKing = game.add.sprite(405, 5, 'bking');
        bKing.inputEnabled = true;
        bKing.input.enableDrag();
        bKing.input.enableSnap(100, 100, false, true, 5, 5);
        bKing.events.onDragStop.add(kingMove, this);
        bKing.originX = bKing.x;
        bKing.originY = bKing.y;
        allPieces.add(bKing);

        var b1Rook = makeRook('black', 705, 5);
        allPieces.add(b1Rook);

        var b2Rook = makeRook('black', 5, 5);
        allPieces.add(b2Rook);

        // b1Rook = game.add.sprite(705, 5, 'b1Rook');
        // b1Rook.inputEnabled = true;
        // b1Rook.input.enableDrag();
        // b1Rook.input.enableSnap(100, 100, false, true, 15, 15);
        // b1Rook.events.onDragStop.add(rookMove, this);
        // b1Rook.originX = b1Rook.x;
        // b1Rook.originY = b1Rook.y;
        // allPieces.add(b1Rook);

        // b2Rook = game.add.sprite(5, 5, 'b2Rook');
        // b2Rook.inputEnabled = true;
        // b2Rook.input.enableDrag();
        // b2Rook.input.enableSnap(100, 100, false, true, 5, 5);
        // b2Rook.events.onDragStop.add(rookMove, this);
        // b2Rook.originX = b2Rook.x;
        // b2Rook.originY = b2Rook.y;
        // allPieces.add(b2Rook);

        b1Bishop = game.add.sprite(205, 5, 'b1Bishop');
        b1Bishop.inputEnabled = true;
        b1Bishop.input.enableDrag();
        b1Bishop.input.enableSnap(100, 100, false, true, 5, 5);
        b1Bishop.events.onDragStop.add(bishopMove, this);
        b1Bishop.originX = b1Bishop.x;
        b1Bishop.originY = b1Bishop.y;
        allPieces.add(b1Bishop);

        b2Bishop = game.add.sprite(505, 5, 'b2Bishop');
        b2Bishop.inputEnabled = true;
        b2Bishop.input.enableDrag();
        b2Bishop.input.enableSnap(100, 100, false, true, 5, 5);
        b2Bishop.events.onDragStop.add(bishopMove, this);
        b2Bishop.originX = b2Bishop.x;
        b2Bishop.originY = b2Bishop.y;
        allPieces.add(b2Bishop);

        var b1Knight = makeKnight("black", 105, 5);
        allPieces.add(b1Knight);

        var b2Knight = makeKnight("black", 605, 5);
        allPieces.add(b2Knight);

        allPieces.setAll('height', 90);
        allPieces.setAll('width', 90);


    }

    function clickedBlock() {
      if (currentTile.x >= 0 && currentTile.x <= 8 && currentTile.y >= 0 && currentTile.y <= 8)
      {
        square = grid[currentTile.y][currentTile.x];
        square.alpha = 0.5;
      }
      console.log("clicked!");
    }

    function kingMove(item, pointer){
      if (Math.abs(item.originX - item.x) > 100 || Math.abs(item.originY - item.y) > 100) {
        game.add.tween(item).to({x: item.originX, y: item.originY}, 400, Phaser.Easing.Back.Out, true);
      } else {
        item.originX = item.x;
        item.originY = item.y;
      }
    }
    

    function bishopMove(item, pointer){
      if (item.originX === item.x || item.originY === item.y){
        game.add.tween(item).to({x: item.originX, y: item.originY}, 400, Phaser.Easing.Back.Out, true);
  
      }else{
        item.originX = item.x;
        item.originY = item.y;
      }
    }




    function update(){
      currentTile.x = this.game.math.snapToFloor(game.input.x, 100)/100;
      currentTile.y = this.game.math.snapToFloor(game.input.y, 100)/100;
    }

    function render() {
      game.debug.text('Tile X: ' + currentTile.x + 'Y: ' + currentTile.y, 5, 5);
    }
};

</script>

</body>
</html>